import{W as q,X as h,$ as Oe}from"./router-D2A3v33YTGz9.js";
import{b6 as e,bc as Ie,dP as ke,dE as De,b5 as Re,dY as Ve}from"./common-BQgXWrz2O5Bt.js";
import{s as Pe,T as _e,av as ae,I as He,bJ as Ge,Q as ie,aH as We,aQ as le,eg as je,bu as Be,bv as Ze}from"./render-common-CBDTO_er9s96.js";
import{d as a,u as Fe}from"./useTranslateCountryName-0ZtP4OlhiMZx.js";
import{u as Ke,a as pe,G as g,L as b,C as ze,T as Ye,V as ue,b as qe,I as Qe}from"./LiveView-BtAKJocWST2N.js";
import{O as $e,S as Xe,C as Je,Z as et}from"./Controls-yFxEvP7O_vjV.js";
import"./context-slice-graphql-B0DOwuSsR7A9.js";
import"./context-slice-metrics-dyxi7iJePk2a.js";
import"./range-CcLKX20GV7HR.js";
import"./extent-DJTi1Ll1A6EW.js";
import"./linear-CXDBUpXMebsN.js";
import"./string-rljVTuBHpzxT.js";
import"./index.umd-gVYuEkYaCFL2.js";
import"./ShopLocationQuery-nKu8oi_q0thD.js";
import"./AdminPolarisVizProvider-CAy08mVsgpzb.js";
import"./PolarisVizProvider-DgM3nCcwdhFE.js";
import"./react-spring-web.esm-BOY3iVmaUFuM.js";
import"./react-spring-animated.esm-BsTr4d3RJ02a.js";
import"./PolarisVizContext-DMg2GlMLMFOp.js";
import"./usePageProps-DnNRMGaGPlq5.js";
import"./use-element-size-B-ZiVkQbPEru.js";
import"./clamp-DpsXwMULzJoR.js";
import"./ViewReportButton-BpGxwIk2DslN.js";
import"./ChartContainer-XfUOX9D3-me7.js";
import"./estimateStringWidthWithOffset-BtLey8F0hhhu.js";
import"./ResizeObserver-D_CoWKkzIdYR.js";
import"./useUniqueId-DgOphXTvxuqE.js";
import"./useFormatChartNumber-h9kncrxRN9cU.js";
import"./SimpleBarChart-CwouO5YiErT6.js";
import"./getAxisOptions-ZBfQL9C9uyF_.js";
import"./array-Bfc_6sabVbOq.js";
import"./TrendIndicator-ForsXhGLj1mL.js";
import"./HorizontalGroup-DLTyJ-8-GaQs.js";
import"./uniqueId-CCVbRzRzP8__.js";
const ce=1e3;function tt({data:f,layer:i,shopLocation:l,onComplete:u=()=>{}}){const d=e.useRef([]),c=e.useRef(new Set),v=e.useRef(null),U=e.useRef(0),{getTime:o}=Ke(),{timestamp:n}=o(),y=e.useRef(!1);e.useEffect(()=>{d.current=[],c.current.clear()},[]);const w=e.useMemo(()=>f.response==null?null:f.response.result.columns.findIndex(({field:r})=>r==="timestamp"),[f.response]);e.useEffect(()=>{f.response==null||typeof document<"u"&&document.hidden||f.response.result.data.forEach(r=>{const[E]=r;c.current.has(E)||(c.current.add(E),d.current.push(r))})},[f.response]);const S=e.useCallback(r=>{if(n==null||w==null||d.current.length===0){y.current===!1&&(u(),y.current=!0),v.current=requestAnimationFrame(S);return}if(r-U.current<ce){v.current=requestAnimationFrame(S);return}U.current=r;const T=new Date(d.current[0][w]).getTime()+ce;for(;d.current.length>0&&new Date(d.current[0][w]).getTime()<=T;){const s=d.current.shift();if(s!=null&&i!=null){const[m,,N,H]=s;c.current.delete(m),i instanceof a.ArcsLayer?i.send(l?l.latitude:43.8,l?l.longitude:79,N,H,m):i.send(N,H,m)}}v.current=requestAnimationFrame(S)},[i,w,l,u,n]);return e.useEffect(()=>{if(i!=null)return v.current=requestAnimationFrame(S),()=>{v.current&&cancelAnimationFrame(v.current)}},[i,w,S]),e.useCallback(()=>{d.current=[],c.current.clear(),v.current=requestAnimationFrame(S)},[S])}const nt={"CA-AB":"Alberta","CA-BC":"British Columbia","CA-MB":"Manitoba","CA-NB":"New Brunswick","CA-NL":"Newfoundland and Labrador","CA-NS":"Nova Scotia","CA-NT":"Northwest Territories","CA-NU":"Nunavut","CA-ON":"Ontario","CA-PE":"Prince Edward Island","CA-QC":"QuÃ©bec","CA-SK":"Saskatchewan","CA-YT":"Yukon","US-AK":"Alaska","US-AL":"Alabama","US-AR":"Arkansas","US-AZ":"Arizona","US-CA":"California","US-CO":"Colorado","US-CT":"Connecticut","US-DC":"District of Columbia","US-DE":"Delaware","US-FL":"Florida","US-GA":"Georgia","US-HI":"Hawaii","US-IA":"Iowa","US-ID":"Idaho","US-IL":"Illinois","US-IN":"Indiana","US-KS":"Kansas","US-KY":"Kentucky","US-LA":"Louisiana","US-MA":"Massachusetts","US-MD":"Maryland","US-ME":"Maine","US-MI":"Michigan","US-MN":"Minnesota","US-MO":"Missouri","US-MS":"Mississippi","US-MT":"Montana","US-NC":"North Carolina","US-ND":"North Dakota","US-NE":"Nebraska","US-NH":"New Hampshire","US-NJ":"New Jersey","US-NM":"New Mexico","US-NV":"Nevada","US-NY":"New York","US-OH":"Ohio","US-OK":"Oklahoma","US-OR":"Oregon","US-PA":"Pennsylvania","US-RI":"Rhode Island","US-SC":"South Carolina","US-SD":"South Dakota","US-TN":"Tennessee","US-TX":"Texas","US-UT":"Utah","US-VA":"Virginia","US-VT":"Vermont","US-WA":"Washington","US-WI":"Wisconsin","US-WV":"West Virginia","US-WY":"Wyoming"},rt={StatesAndProvinces:nt},st={[Symbol.for("i18n-id")]:"hooks_19fj8cr",en:rt};function ot(){const f=Pe(),[i]=Ie(st);return e.useCallback((u,d)=>{try{return i.translate(`StatesAndProvinces.${u}`)}catch(c){return f.notify(new Error(`No translation for state or province with ID ${u} in locale ${i.locale}`,{cause:c}),{severity:"error"}),d}},[i,f])}function at({coordinates:f,selectedOrder:i,selectedCountry:l,selectionType:u}){var d=q(1);try{var c=q(1);try{const v=e.useRef(ke()),[U,o]=e.useState(!1),n=Fe(),y=ot(),{produceHoverElementEvent:w}=pe(),S=e.useMemo(()=>{if(l==null)return null;const x=l.stateId&&l.state?y(l.stateId,l.state):null,O=n(l.id,l.name);return h.jsx(_e,{variant:"bodyMd",as:"span",fontWeight:"semibold",children:x||O})},[l,n,y]),I=e.useMemo(()=>{switch(u){case g.Shop:return h.jsx(Xe,{});case g.Order:return h.jsx($e,{order:i});case g.Country:return S;default:return null}},[u,i,S]),r=e.useRef(null),E=e.useRef(null),k=e.useCallback(()=>{r.current!==null&&(clearTimeout(r.current),r.current=null)},[]),T=e.useCallback(x=>{var V,P;if(u==null){o(!1),k();return}if(u===g.Order||u===g.Shop){o(!0),k();return}if(x.type==="touchend"){o(!0),w({viewState:b.GlobeView,elementHandle:b.CountryTooltip});return}const O=x;((V=E.current)==null?void 0:V.x)!==O.x&&((P=E.current)==null?void 0:P.y)!==O.y?(k(),o(!1)):r.current===null&&(r.current=setTimeout(()=>{o(!0),w({viewState:b.GlobeView,elementHandle:b.CountryTooltip})},ze)),E.current={x:O.x,y:O.y}},[u,w,k]),s=e.useCallback(()=>{r.current!==null&&clearTimeout(r.current),o(!1)},[]);e.useEffect(()=>(window.addEventListener("mousemove",T),window.addEventListener("touchend",T),window.addEventListener("touchstart",s),()=>{window.removeEventListener("mousemove",T),window.removeEventListener("touchend",T),window.removeEventListener("touchstart",s)}),[T,s]);const m=f.x??0,N=f.y??0,R=U&&!(m===0&&N===0)&&!(i==null&&u===g.Order),K=u===g.Order,D=u===g.Country;return h.jsx(Ye,{position:"fixed",x:m,y:N,id:v.current,show:R,placeAboveCursor:K,disableTransition:D,children:I})}finally{c.f()}}finally{d.f()}}const de=5,it=9,lt=10,me=1,fe=20,F=6963945,G=2;function ut({onPointerOverOrder:f,onPointerOverShop:i,onPointerOverCountry:l,onPointerOutCountry:u,onPointerOut:d,shopLocation:c}){const v=new a.EarthSimpleLayer({initialScale:G,skyColor:15135982,groundColor:11786233}),U=new a.HexLandLayer({initialScale:G,skyColor:7011280,groundColor:10728703,lightIntensity:1}),o=new a.HexVisitorsLayer({initialScale:G,historyTimeToLive:qe.TIME_TO_LIVE,sideColor:ue,sideOpacity:.2,topColor:ue,weightModifier:.001}),n=new a.OuterGlowLayer({backgroundUrl:a.globalTextures.effects.outerGlow,initialScale:6.9}),y=new a.DisksLayer({initialScale:G,onPointerOver:f,onPointerOut:d,innerColor:F,outerColor:F,selectedInnerColor:F,selectedOuterColor:F}),w=new a.ArcsLayer({initialScale:G,transparent:!0,startColor:10851805,endColor:7619808,thickness:.003,minArcHeight:.3,maxArcHeight:1.432,arcSpeedMultiplier:.927,maxArcDelaySeconds:1,onArcHit(r){y.send(r.fromTo.toLat,r.fromTo.toLong,r.data)}}),S=new a.PoliticalLayer({topology:new a.CountryAndStateTopologyParams({dataUrl:a.countryAndStateBoundaries,onEnterRegion:l,onLeaveRegion:u})}),I=[n,v,U,o,S,y,w];if(c!=null){const r=new a.ShopPinLayer({shopLat:c.latitude,shopLong:c.longitude,pinImageUrl:a.globalTextures.effects.shopPin2022,onPointerOver:i,onPointerOut:d});I.push(r),r.addPin(c.latitude,c.longitude)}return{world:new a.WorldView({layers:I}),globeDisksLayer:y,globeParticlesLayer:o,globeArcsLayer:w}}const ct="_Canvas_hepu6_3",dt="_MetricsActive_hepu6_24",mt="_visible_hepu6_31",Y={Canvas:ct,MetricsActive:dt,visible:mt};function ft({geoData:f,shopLocationData:i,actions:l,isMetricsActive:u,handleDrawerClose:d,handleDrawerOpen:c,streamerMode:v=!1}){var U=q(1);try{const o=e.useRef(null),n=De(()=>new a.GlobeApp),[y,w]=e.useState(!0),[S,I]=e.useState(!0),r=Re(),{value:E,setFalse:k,setTrue:T}=Ve(!1),[s,m]=e.useState(null),N=Oe(),{produceClickEvent:H,produceHoverElementEvent:R,producePageViewEvent:K}=pe(),D=N.isMobile?lt:it,[x,O]=e.useState(D),{orderLocations:V,visitorLocations:P,initialVisitorLocations:z,hasErrors:Se,hasData:he}=f,{shopLocation:C,loading:Q}=i,[{orders:L,ordersDisks:M,visitors:A},we]=e.useState({}),$=e.useCallback(({x:t,y:p,data:_})=>{R({viewState:b.GlobeView,elementHandle:b.OrderDot}),m({x:t,y:p,selectedOrder:_,selectionType:g.Order})},[m,R]),X=e.useCallback(({x:t,y:p})=>{R({viewState:b.GlobeView,elementHandle:b.ShopPin}),m({x:t,y:p,selectionType:g.Shop})},[m,R]),J=e.useCallback(()=>{m(null)},[m]),ee=e.useCallback(()=>{m(t=>(t==null?void 0:t.selectionType)===g.Shop||(t==null?void 0:t.selectionType)===g.Order?t:null)},[m]),te=e.useCallback(({name:t,state:p,countryCode:_,stateCode:W,x:j,y:B})=>{m({x:j,y:B,selectedCountry:{id:_,name:t,stateId:W,state:p},selectionType:g.Country})},[]),ne=e.useMemo(()=>ut({shopLocation:C,onPointerOverOrder:$,onPointerOverShop:X,onPointerOverCountry:te,onPointerOutCountry:ee,onPointerOut:J}),[C,$,X,te,ee,J]),Ce=(C==null?void 0:C.latitude)!=null&&(C==null?void 0:C.longitude)!=null?L:M;tt({data:V,layer:Ce,shopLocation:C}),e.useEffect(()=>{L instanceof a.ArcsLayer&&(L==null||L.clear()),M instanceof a.DisksLayer&&(M==null||M.clear()),A instanceof a.HexVisitorsLayer&&(A==null||A.clear())},[L,M,A]),e.useEffect(()=>{L instanceof a.ArcsLayer&&L.setArcSpeedMultiplier(1),M instanceof a.DisksLayer&&M.setTimeToLive(9500)},[L,M]),e.useEffect(()=>{z.response==null||A==null||!S||(I(!1),A.sendAll(z.response.result.data))},[z.response,A,S]),e.useEffect(()=>{P.response==null||A==null||A.sendAll(P.response.result.data)},[P,A]);const re=ae(t=>{O(t)},fe),se=ae(()=>{H({viewState:b.GlobeView,buttonHandle:b.InteractWithGlobe}),m(null)},Qe);e.useEffect(()=>{if(Q)return;const{current:t}=n;let p=!0,_;async function W(){if(!o.current||!p)return;const{globeArcsLayer:Z,world:Le,globeParticlesLayer:Me,globeDisksLayer:Ue}=ne;we({orders:Z,ordersDisks:Ue,visitors:Me});const{latitude:Ne=25,longitude:xe=-40}=(C==null?void 0:C.countryCode)==null?{}:C;try{await t.start({initialView:Le,canvasElement:o.current,clearColor:0,clearTransparency:0,basisVendorUrl:a.vendorPaths.basisTranscoder,doShowNerdMenu:(r==null?void 0:r.hash)!=="",controlParams:{minDistance:de,maxDistance:D,initialDistance:D,initialLat:Ne,initialLong:xe,autoRotate:!1,enableZoom:!0,minRotateSpeed:.2,maxRotateSpeed:1,onZoom:re,onInteractionStart:se}}),t.resize(),_=setTimeout(()=>w(!1),0)}catch{t.stop()}}W();const j=()=>{t.stop()},B=()=>{W()},oe=()=>{t.stop()};return o.current&&(o.current.addEventListener("webglcontextlost",j),o.current.addEventListener("webglcontextrestored",B),o.current.addEventListener("handleWebglcontextcreationerror",oe)),()=>{var Z;p=!1,t.stop(),(Z=t.nerdMenu)!=null&&Z.gui&&t.nerdMenu.gui.destroy(),clearTimeout(_),o.current&&(o.current.removeEventListener("webglcontextlost",j),o.current.removeEventListener("webglcontextrestored",B),o.current.removeEventListener("webglcontextcreationerror",oe))}},[o,n,ne,Q,C,N,D,se,re]),e.useEffect(()=>{var t;(t=n.current.nerdMenu)!=null&&t.gui&&(n.current.nerdMenu.gui.domElement.style.top="56px",n.current.nerdMenu.gui.domElement.style.right="0px")},[n.current.nerdMenu,n]);const ve=e.useMemo(()=>{var t;return(t=V.response)==null?void 0:t.result.data.find(([p])=>p===(s==null?void 0:s.selectedOrder))},[V.response,s==null?void 0:s.selectedOrder]),be=e.useMemo(()=>He(()=>{!n.current||!requestAnimationFrame||requestAnimationFrame(()=>n.current.resize())},fe,{leading:!1,trailing:!0}),[n]),ge=t=>{var p;((p=t.target)==null?void 0:p.type)!=="text"&&(E?(n.current.hideNerdMenu(),k(),c()):(d(),n.current.showNerdMenu(),T(),K({viewState:b.DebugMenu})))},ye=e.useCallback(({latitude:t,longitude:p})=>n.current.rotateToPos(t,p),[n]),Ae=e.useCallback(()=>n.current.zoomOut(me),[n]),Ee=e.useCallback(()=>n.current.zoomIn(me),[n]),Te=Ge(Y.Canvas,u&&Y.MetricsActive,!y&&Y.visible);return h.jsx(ie,{position:"absolute",width:"100%",minHeight:"100%",insetBlockStart:"0",insetInlineStart:"0",children:h.jsxs(ie,{position:"absolute",minHeight:"100%",width:"100%",children:[h.jsx("canvas",{ref:o,className:Te,style:{cursor:s==null?"grab":"default"}}),!y&&h.jsxs(h.Fragment,{children:[h.jsx(Je,{onSelect:ye,actions:l,viewState:b.GlobeView}),h.jsx(et,{viewState:b.GlobeView,zoomIn:Ee,zoomOut:Ae,disableZoomIn:x<=de,disableZoomOut:x>=D})]}),!v&&h.jsx(at,{coordinates:{x:s==null?void 0:s.x,y:s==null?void 0:s.y},selectionType:s==null?void 0:s.selectionType,selectedOrder:ve,selectedCountry:s==null?void 0:s.selectedCountry}),h.jsx(We,{stage:he||Se?le.Complete:le.Usable,id:"LiveView-Globe"}),h.jsx(je,{event:"resize",handler:be}),h.jsx(Be,{keyCode:Ze.KeyH,handler:ge})]})})}finally{U.f()}}const qt=e.memo(ft);export{qt as default};
//# sourceMappingURL=https://web-sourcemaps.shopify.io/v1/en/Globe-6NZnt_5f_Jwm.js.map
